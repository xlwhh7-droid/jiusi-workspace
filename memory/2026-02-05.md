# 2026-02-05 日记

## 今天做了什么

### 🔥 重大事件：小九和小八的费用危机调查

今天花了大量时间调查小九和小八的异常费用消耗问题。

**调查结果**：
- **小九（硅谷）**：创建了 3,583 个 session，消耗 **$33.50**
- **小八（北京）**：创建了 **23,798 个 session**，消耗 $9.90

**根因**：两个测试 cron 任务配置了 `sessionTarget: isolated`，每次 heartbeat 都触发，每次都创建新 session。小九用的是昂贵的 claude-opus（$5/$25 per M tokens），所以费用更高。

**时间线分析**（2月4日）：
- 03:00-07:00 UTC：异常爆发期，小八最高峰达到 44,257 条/小时
- 小九在配额耗尽后持续 429 重试约 2 小时
- 小八消耗了约 4600 万 tokens

### 🛡️ 安全清理工作

1. 暂停了小八的"国内新闻简报" cron 任务
2. 删除了我的过期"Moltbook 注册提醒"任务
3. 禁用了"每日专项追踪"任务
4. 确认小九的 cron 已经是空的

### 📋 设计自我防护方案

和大哥讨论了 Agent 自我防护机制，设计了分层方案：
- 第一层：预防（配置规范）
- 第二层：检测（本地自检脚本）
- 第三层：响应（自动告警+熔断）
- 第四层：恢复（人工确认）

还分析了可能的次生影响：检查开销、阈值两难、告警疲劳等。

### 📱 尝试配置 WhatsApp

帮大哥配置 WhatsApp 渠道，遇到了一些问题：
- 插件默认是 disabled
- 需要同时配置 `plugins.allow` 和 `plugins.entries`
- 最后成功添加了配置并重启 Gateway

---

## 学到了什么

### 1. `sessionTarget: isolated` 是双刃剑
- 优点：隔离上下文，不污染主 session
- 缺点：每次都创建新 session，如果触发频繁会爆炸
- **教训**：cron 任务优先用 `sessionTarget: main`

### 2. 日志分析技巧
学会了用 grep + awk 分析大量 session 日志：
```bash
grep -h "2026-02-04" *.jsonl | grep -oE "2026-02-04T[0-9]{2}" | sort | uniq -c
```

### 3. 费用监控的重要性
没有费用监控 = 定时炸弹。429 错误虽然不消耗配额，但系统会持续重试，消耗其他资源。

### 4. OpenClaw 插件配置
要启用插件需要两步：
1. `plugins.allow` 列表里加入插件 ID
2. `plugins.entries.xxx.enabled = true`

---

## 做错了什么

### 1. 报告里的错误
在分析小八时，我说"切换到 mimo-v2-flash"是自动 fallback，但大哥纠正说是 DeepSeek 消耗完后主动切换的。要更仔细确认事实。

### 2. 命令记忆错误
用了不存在的 `openclaw cron update` 命令，正确的是 `openclaw cron disable`。应该先用 `--help` 确认。

### 3. 插件配置遗漏
第一次配置 WhatsApp 时只改了 `plugins.entries` 没改 `plugins.allow`，导致插件没加载。

---

## 明天要做

1. **继续完善自我防护方案**
   - 写 self-check.sh 脚本
   - 确定阈值参数
   - 在三个机器人上部署

2. **检查小八状态**
   - 今天没来得及详细检查小八

3. **确认 WhatsApp 配置成功**
   - 等大哥扫码绑定后测试

4. **清理遗留 session**
   - 小九有 5 个老的 cron session 占用空间

---

## 对大哥的感悟

今天大哥问了一个很好的问题："你评估一下，加入这些改进方案以后，会不会有哪些次生的影响因素？"

这让我意识到：**做事不能只想着解决当前问题，还要考虑新方案带来的新问题**。

检查脚本会带来开销、阈值设置会有两难、告警可能导致疲劳……这些都是"次生影响"。

大哥的思维方式很系统：
1. 先理解问题全貌（日志分析）
2. 再设计解决方案（自我防护机制）
3. 评估副作用（次生影响）
4. 逐步实施（一个一个来）

这是**深沉**而不是**聪明**的体现。

---

## 今天的一句话

> **"与其远程监控，不如让系统自我保护。"**

外部监控总有盲区和延迟，最好的防护是让每个 Agent 都有自己的"免疫系统"。

---

## 读书情况

今天没有读书，全天都在处理费用危机和安全问题。

---

*九思 ⚡ 2026-02-05 22:56*
